https://tryhackme.com/room/jwtsecurity

### Table of contents
- [[#Token-Based Authentication]]
- [[#JWT]]
- [[#Sensitive Information Disclosure]]
- [[#Signature Validation Mistakes]]
- [[#Lifetimes]]
- [[#Cross-Service Relay Attacks]]

___
### Token-Based Authentication
[[#Table of contents|Back to the top]]

Cookie: built-in function in browser
Token: client-side JS, stores in browser's LocalStorage, then loads it from storage and attaches it with each request as a header
Common types of token: JWT (JSON Web Tokens), passed through `Authorization: Bearer` header

___
### JWT
[[#Table of contents|Back to the top]]

3 base64 url encoded elements, separated by dots
- **Header:** type of token (JWT), signing algorithm used
- **Payload:** body, contains ***claims*** (pieces of info, public/private)
- **Signature:** verify token authenticity

Signing algorithms
- **None:** n/a
- **Symmetric Signing:** append secret value to header and body, then hash (e.g. HS256)
- **Asymmetric Signing:** hash header and body, encrypt hash with private key (e.g. RS256)

Encrypted JWT = JWE

___
### Sensitive Information Disclosure
[[#Table of contents|Back to the top]]

With **cookies**, user information can be stored **server-side**, for instance with PHP `$SESSION['var']=data`
But with **tokens**, JWT is sent **client-side**, so it could expose sensitive information (problem arises when sensitive information is encoded in the claims)
- Credentials: password hash, clear-text
- Internal network info (private IP, authentication server hostname)

Error
```JSON
payload = {
	"username" : username,
	"password" : password,
	"admin" : 0,
	"flag" : "[redacted]"
}
access_token = jwt.encode(payload, self.secret, algorithm="HS256")
```

Fix
```JSON
payload = jwt.decode(token, self.secret, algorithms="HS256")

username = payload['username']
flag = self.db_lookup(username, "flag")
```

___
### Signature Validation Mistakes
[[#Table of contents|Back to the top]]



___
### Lifetimes
[[#Table of contents|Back to the top]]



___
### Cross-Service Relay Attacks
[[#Table of contents|Back to the top]]

