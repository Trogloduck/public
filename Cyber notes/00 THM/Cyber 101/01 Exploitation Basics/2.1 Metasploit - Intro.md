https://tryhackme.com/room/metasploitintro

### Table of contents
- [[#Intro]]
- [[#`msfconsole`]]

___
### Intro
[[#Table of contents|Back to the top]]

Set of tools used for information gathering, scanning, exploitation, exploit development, post-exploitation, ...

Main components
- **msfconsole**: main CLI
- **Modules**: supporting modules built to perform specific task (exploits, scanners, payloads, etc.)
- **Tools**: stand-alone tools that will help vulnerability research,Â vulnerability assessment, penetration testing. Some of these tools are *msfvenom*, *pattern_create* and *pattern_offset*

Types of modules
- **Auxiliary**: supporting module (scanners, crawlers, fuzzers, ...)
- **Encoders**: encode exploit/payload to escape signature-based defenses
- **Evasion**: try to evade antivirus software
- **Exploits**: exploit vulnerability for initial access
- **NOPs** - No OPeration: do nothing, used as buffer to achieve consistent payload size
- **Payloads**: code that will run on target
	- **Adapters**: wraps payload to convert into different format (turns payload into a powershell command for instance)
	- **Singles**: self-contained payloads
	  Indicated by "\_": `shell_reverse_tcp`
	- **Stagers**: set up a connection channel between metasploit and target system, allows for smaller initial payload size
	  Indicated by "/": `shell/reverse_tcp`
	- **Stages**: downloaded by stager, allows to use larger payloads
- **Post**: used during post-exploitation

___
### `msfconsole`
[[#Table of contents|Back to the top]]

Launch with `msfconsole`

**`help`**

**`use exploit/windows/smb/ms17_010_eternalblue`**: starts the use of the exploit eternal blue
We stay in the folder we are in even if the prompt changes to show which in which context set we are working:
`msf6 exploit(windows/smb/ms17_010_eternalblue) >`

`info`: displays information about module which we are using

**`show options`**: prints options related to exploit
	`set [parameter_name] [value]`: set a value for a parameter
	`setg [parameter_name] [value]`: sets value for parameter across multiple modules >< `unsetg ...`
	`unset [parameter_name/all]`: unset specific/all parameter(s)

`show [module_type]` - `show payloads`: shows list of available modules (payloads in the example)

**`back`**: leave context

**`search [CVE number, exploit name, target system, ...]`**: conducts search within Metasploit Framework database for relevant modules

Following a search, `use [# of module in the results]` is a quick way to launch the module

___
### Working with modules
[[#Table of contents|Back to the top]]

**Prompts**

Regular prompt
`root@ip-10-10-XX-XX:~#`

Metasploit command prompt
`msf6 >`

Context command prompt
`msf6 exploit(windows/smb/ms17_010_eternalblue) >`

Meterpreter command prompt (important payload)
`meterpreter >`

Shell on target command prompt
`C:\Windows\system32>`


Common parameters

- **RHOSTS** - *remote host*: target IP address, single or range, CIDR (/24, /16, ...) or range (10.10.10.x - 10.10.10.y)
  A file.txt with one IP per line can also be used: `set RHOSTS file:[PATH_TO_FILE]`
- **RPORT** - *remote port*: port on target machine on which target app is running
- **PAYLOAD**: payload used with exploit
- **LHOST** - *local host*: attacking machine IP 
- **LPORT** - *local port*: port used for reverse shell to connect back to (any available port) 
- **SESSION**: each connection established to target using Metasploit has ID, used in post-exploitation to connect to target using existing connection

Once all required parameters are set, `exploit` or `run`

Some modules support `check` option: checks whether target is vulnerable without exploiting

`background` / CTRL + Z: background session prompt and go back to msfconsole prompt - useful to work on several target / same target but different exploits/shells

`sessions`: display existing sessions
	`sessions -i [Id]`: connect to desired session

